(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0c554b"],{"3f46":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-container",[s("v-row",{attrs:{align:"center",justify:"center"}},[s("v-col",{attrs:{cols:"12",xl:"11",lg:"11",md:"11",sm:"12",xs:"12"}},[s("h3",[t._v("撰写文章")]),s("v-divider"),s("v-text-field",{attrs:{label:"标题","hide-details":"auto","prepend-icon":"mdi-format-title"},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}}),s("br"),s("Mdedit",{ref:"editor"}),s("v-container",{attrs:{fluid:""}},[s("v-combobox",{attrs:{items:t.tag,"search-input":t.search,clearable:"",hint:"最多4个",label:"添加标签","item-text":"name","item-value":"_id",multiple:"","persistent-hint":"","small-chips":"","prepend-icon":"mdi-tag-plus"},on:{"update:searchInput":function(e){t.search=e},"update:search-input":function(e){t.search=e}},scopedSlots:t._u([{key:"no-data",fn:function(){return[s("v-list-item",[s("v-list-item-content",[s("v-list-item-title",[t._v(' 没有搜索到 "'),s("strong",[t._v(t._s(t.search))]),t._v('". 请按 '),s("kbd",[t._v("enter")]),t._v(" to create a new one ")])],1)],1)]},proxy:!0}]),model:{value:t.selectTag,callback:function(e){t.selectTag=e},expression:"selectTag"}})],1),s("v-divider"),s("v-combobox",{attrs:{label:"选择分类",items:t.classifications,"item-text":"name","item-value":"_id","prepend-icon":"mdi-book-plus"},model:{value:t.selectClass,callback:function(e){t.selectClass=e},expression:"selectClass"}}),s("v-divider"),s("v-text-field",{attrs:{label:"大头图url"},model:{value:t.cover,callback:function(e){t.cover=e},expression:"cover"}}),s("v-text-field",{attrs:{label:"小头图url"},model:{value:t.coverSmall,callback:function(e){t.coverSmall=e},expression:"coverSmall"}}),s("v-row",{attrs:{justify:"end"}},[s("v-spacer"),s("v-btn",{staticClass:"ma-3",attrs:{color:"#2196f3",outlined:""},on:{click:t.draft}},[t._v(t._s(t.state0))]),s("v-btn",{staticClass:"ma-3",attrs:{color:"success"},on:{click:t.send}},[t._v(t._s(t.state))]),s("v-btn",{attrs:{color:"success"},on:{click:t.mdtheme}},[t._v("text")])],1)],1)],1)],1)},a=[],l=(s("2f2f"),s("6b41")),o={components:{Mdedit:l["a"]},data(){return{tag:[],classifications:[],fieldsId:"",contentsId:"",title:"",cover:"",coverSmall:"",selectTag:[],originalSelectTag:[],selectClass:"",search:null,state:"...",state0:"...",isDraft:Boolean}},mounted(){},beforeCreate(){},created(){this.fieldsId=this.$route.params.id,this.getParams(),this.getTag(),this.getClassification()},methods:{mdtheme(){},async getParams(){const t=await this.$http.getFieldsById(this.fieldsId);this.isDraft=t[0].isDraft,1==this.isDraft?(this.state0="更新草稿",this.state="发布"):(this.state0="存为草稿",this.state="更新"),this.title=t[0].title,this.coverSmall=t[0].coverSmall,this.cover=t[0].cover,this.selectTag=t[0].tag,this.selectClass=t[0].classification;let e=t[0].contentsId.mdText;this.contentsId=t[0].contentsId._id,this.$refs.editor.setData(e)},async draft(){let t={text:this.$refs.editor.getHTML(),mdText:this.$refs.editor.getData()};const e=await this.$http.updataContent(this.contentsId,t);let s={title:this.title,tag:this.selectTag.map(t=>t._id),classification:this.selectClass._id,cover:this.cover,coverSmall:this.coverSmall,isDraft:!0};const i=await this.$http.updataField(this.fieldsId,s);let a={fieldsId:i[0]._id,ContentTd:e[0]._id};if(1==this.isDraft);else{let t=this.selectTag.map(t=>t._id),e=this.originalSelectTag.map(t=>t._id);const s=new Set(t),i=new Set(e);console.log("originalTag",e);let a=t.filter(t=>!i.has(t)),l=e.filter(t=>!s.has(t));console.log("add",a),console.log("rm",l),await this.$http.TagContentsNum(l,-1),await this.$http.ClassificationContentsNum(this.selectClass._id,-1)}await this.$http.addField(a),await this.$http.createdToc(e[0]._id);i[0].contentsId===e[0]._id?(this.success("保存成功"),this.$router.push("/write/draft")):this.error("保存失败")},async send(){let t={text:this.$refs.editor.getHTML(),mdText:this.$refs.editor.getData()};const e=await this.$http.updataContent(this.contentsId,t);let s={title:this.title,tag:this.selectTag.map(t=>t._id),classification:this.selectClass._id,cover:this.cover,coverSmall:this.coverSmall,isDraft:!1};if(1==this.isDraft)await this.$http.ClassificationContentsNum(this.selectClass._id,1),await this.$http.TagContentsNum(this.selectTag.map(t=>t._id),1);else{await this.$http.ClassificationContentsNum(this.selectClass._id,1);let t=this.selectTag.map(t=>t._id),e=this.originalSelectTag.map(t=>t._id);const s=new Set(t),i=new Set(e);console.log("originalTag",e);let a=t.filter(t=>!i.has(t)),l=e.filter(t=>!s.has(t));console.log("add",a),console.log("rm",l),await this.$http.TagContentsNum(a,1),await this.$http.TagContentsNum(l,-1)}const i=await this.$http.updataField(this.fieldsId,s);let a={fieldsId:i[0]._id,ContentTd:e[0]._id};await this.$http.addField(a);const l=await this.$http.createdToc(e[0]._id);console.log(l),i[0].contentsId===e[0]._id?(this.success("发送成功"),this.$router.push("/manage/manageArticles")):this.error("发送失败")},async getTag(){const t=await this.$http.getTag();this.tag=t[0].data},async getClassification(){const t=await this.$http.getClassification();this.classifications=t[0].data,this.originalSelectTag=this.selectTag},success(t){this.$toast.success(t,{position:"bottom-right",timeout:5e3,closeOnClick:!0,pauseOnFocusLoss:!0,pauseOnHover:!0,draggable:!0,draggablePercent:.6,showCloseButtonOnHover:!1,hideProgressBar:!0,closeButton:"button",icon:!0,rtl:!1})},error(t){this.$toast.error(t,{position:"bottom-right",timeout:5e3,closeOnClick:!0,pauseOnFocusLoss:!0,pauseOnHover:!0,draggable:!0,draggablePercent:.6,showCloseButtonOnHover:!1,hideProgressBar:!0,closeButton:"button",icon:!0,rtl:!1})}},watch:{model(t){t.length>5&&this.$nextTick(()=>this.model.pop())}}},n=o,c=s("2877"),r=s("6544"),d=s.n(r),h=s("8336"),u=s("62ad"),m=s("2b5d"),g=s("a523"),p=s("ce7e"),f=s("da13"),v=s("5d23"),b=s("0fd9"),C=s("2fa4"),_=s("8654"),w=Object(c["a"])(n,i,a,!1,null,null,null);e["default"]=w.exports;d()(w,{VBtn:h["a"],VCol:u["a"],VCombobox:m["a"],VContainer:g["a"],VDivider:p["a"],VListItem:f["a"],VListItemContent:v["a"],VListItemTitle:v["c"],VRow:b["a"],VSpacer:C["a"],VTextField:_["a"]})}}]);
//# sourceMappingURL=chunk-2d0c554b.0c6c3299.js.map